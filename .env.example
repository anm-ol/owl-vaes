"""AWS_ACCESS_KEY_ID=[your-access-key]
AWS_SECRET_ACCESS_KEY=[your-secret-key]
AWS_ENDPOINT_URL_S3=https://t3.storage.dev
AWS_ENDPOINT_URL_IAM=https://iam.storage.dev
AWS_REGION=auto
AWS_ENDPOINT_URL=https://fly.storage.tigris.dev"""
# Docker Registry Configuration
"PROJECT_ID=YOUR_PROJECT_ID
REGISTRY=us-central1-docker.pkg.dev
REPOSITORY=skypilot
IMAGE_NAME=YOUR_IMAGE_NAME
DEFAULT_TAG=latest"

# Local build configuration
LOCAL_REGISTRY=us-central1-docker.pkg.dev
LOCAL_PROJECT=owl-wms
LOCAL_REPOSITORY=YOUR_BRANCH

# WandB Configuration
WANDB_API_KEY=YOUR_WANDB_API_KEY_HERE

# Tigris/AWS/S3 data stuff
AWS_ACCESS_KEY_ID=YOUR_ACCESS_KEY
AWS_SECRET_ACCESS_KEY=YOUR_SECRET_KEY
AWS_ENDPOINT_URL_S3=https://t3.storage.dev
AWS_ENDPOINT_URL_IAM=https://iam.storage.dev
AWS_REGION=auto
AWS_ENDPOINT_URL=https://fly.storage.tigris.dev

# NCCL configuration for H200 + NDR400 InfiniBand
NCCL_DEBUG=INFO
NCCL_NET=IB
NCCL_IB_DISABLE=0
NCCL_IB_HCA=mlx5_0,mlx5_1,mlx5_2,mlx5_3,mlx5_4,mlx5_5,mlx5_6,mlx5_7
NCCL_CROSS_NIC=1
NCCL_NET_GDR_LEVEL=PHB
NCCL_P2P_LEVEL=SYS

# NDR400 InfiniBand optimizations
NCCL_IB_GID_INDEX=3
NCCL_IB_TC=136
NCCL_IB_SL=0
NCCL_IB_CUDA_SUPPORT=1
NCCL_IB_QPS_PER_CONNECTION=4
NCCL_IB_SPLIT_DATA_ON_QPS=1
NCCL_IB_ADAPTIVE_ROUTING=1
NCCL_IB_TIMEOUT=23
NCCL_IB_RETRY_CNT=7

# Algorithm and buffer settings (optimal for NDR400)
NCCL_ALGO=Ring
NCCL_PROTO=Simple
NCCL_BUFFSIZE=16777216
NCCL_MIN_NCHANNELS=8
NCCL_MAX_NCHANNELS=16
NCCL_TREE_THRESHOLD=4194304

# H200 specific optimizations
NCCL_NVLS_ENABLE=1
NCCL_NTHREADS=640

# PyTorch DDP optimizations
TORCH_NCCL_ASYNC_ERROR_HANDLING=1
CUDA_DEVICE_MAX_CONNECTIONS=1  
  # Get the head node IP
  MASTER_ADDR=$(echo "$SKYPILOT_NODE_IPS" | head -n1)
  echo "Starting distributed training, head node: $MASTER_ADDR"

  # TODO
  # Save compiled artifacts
  # export TRITON_CACHE_DIR=/mnt/data/lapp0/triton_cache

  # DEBUG
  # export TORCH_LOGS="recompiles"
  # export CUDA_LAUNCH_BLOCKING=1
  # export TORCHDYNAMO_VERBOSE=1

  export PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True